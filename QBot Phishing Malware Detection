<form theme="dark">
  <label>QBot Phishing Malware Detection</label>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="field1">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <chart>
        <title>Qbot  Malware Regsvr32.exe-Detects the suspicious child process of calc</title>
        <search>
          <query>
            index=windows  "regsvr32.exe" SourceName="Microsoft-Windows-Sysmon" SourceImage="*regsvr32.exe"
TargetImage="*calc.exe"
|table ComputerName
TargetUser
SourceUser
SourceImage
TargetImage
</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">none</option>
      </chart>
    </panel>
    
    <panel>
      <chart>
        <title>Qbot  Malware Regsvr32.exe-Detects the suspicious regsvr32 Explorer  child process</title>
        <search>
          <query>
         index=windows  "regsvr32.exe" SourceName="Microsoft-Windows-Sysmon" SourceImage="*regsvr32.exe"
TargetImage="*Explorer.exe"
|table ComputerName
TargetUser
SourceUser
SourceImage
TargetImage
</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">none</option>
      </chart>
    </panel>
    
    
    <panel>
      <table>
        <title>Qbot Malware Detection-the DLL-Sideloading of windowscodecs.dll by calc.exe</title>
        <search>
          <query>index=windows WindowsCodecs.dll NOT"C:\\Program Files\\Bitdefender\\Endpoint Security\\EPSecurityService.exe" NOT"C:\\Program Files (x86)\\Kaspersky Lab\\Kaspersky Security for Windows Server\\kavfswp.exe" Object_Name="*WindowsCodecs.dll" 

Process_Name="*calc.exe" | table  EventCode
ComputerName
Account_Name
Object_Name Process_Name</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <chart>
        <title>Abnormal WindowsCodecs dll</title>
        <search>
          <query>index=windows WindowsCodecs.dll NOT"C:\\Program Files\\Bitdefender\\Endpoint Security\\EPSecurityService.exe" NOT"C:\\Program Files (x86)\\Kaspersky Lab\\Kaspersky Security for Windows Server\\kavfswp.exe" Object_Name!="*WindowsCodecs.dll" 

Process_Name!="*TiWorker.exe" | top
Process_Name</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">none</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>WindowsCodecs dll</title>
        <search>
          <query>index=windows WindowsCodecs.dll NOT"C:\\Program Files\\Bitdefender\\Endpoint Security\\EPSecurityService.exe" NOT"C:\\Program Files (x86)\\Kaspersky Lab\\Kaspersky Security for Windows Server\\kavfswp.exe" | table Object_Name Process_Name</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
    <panel>
      <chart>
        <title>Regsvr32.exe</title>
        <search>
          <query>index=windows regsvr32.exe SourceImage!="C:\\Program Files\\Mozilla Firefox\\uninstall\\helper.exe" SourceImage!="C:\\Program Files (x86)\\DesktopCentral_Agent\\bin\\bmagent.exe"  SourceImage!="C:\\Program Files (x86)\\DesktopCentral_Agent\\bin\\EMSAddonInstaller.exe" TargetImage!="C:\\Program Files (x86)\\DesktopCentral_Agent\\bin\\dcinventory.exe"
TargetImage!="C:\\Program Files (x86)\\DesktopCentral_Agent\\bin\\dcpatchscan.exe"	
TargetImage!="C:\\Program Files (x86)\\DesktopCentral_Agent\\bin\\7za.exe" SourceImage!="C:\\Program Files\\Mozilla Firefox\\uninstall\\helper.exe" SourceImage!="C:\\Program Files (x86)\\DesktopCentral_Agent\\bin\\bmagent.exe"  SourceImage!="C:\\Program Files (x86)\\DesktopCentral_Agent\\bin\\EMSAddonInstaller.exe" NOT"RarSFX0\\Installer.exe"|top
SourceImage
</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">none</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>WindowsCodecs dll</title>
        <search>
          <query>index=windows WindowsCodecs.dll NOT"C:\\Program Files\\Bitdefender\\Endpoint Security\\EPSecurityService.exe" NOT"C:\\Program Files (x86)\\Kaspersky Lab\\Kaspersky Security for Windows Server\\kavfswp.exe" | top Process_Name</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">none</option>
      </chart>
    </panel>
  </row>
   <row>
    <panel>
      <table>
        <title>Detects the suspicious commandlines from explorer</title>
        <search>
          <query>index=windows SourceName="Microsoft-Windows-Sysmon" "technique_name=User Execution" EventCode=1 NOT"Microsoft.NET" NOT"bin.net" "Explorer.exe"  ("whoami" OR  "whoami /all" OR 
       "arp -a" OR
       "ipconfig /all" OR
       "net view /all" OR
       "cmd /c set" OR
       "nslookup -querytype=ALL -timeout=10 _ldap._tcp.dc._msdcs" OR
       "nltest /domain_trusts /all_trusts" OR
      "net share" OR
      "netstat -nao" OR
       "net localgroup" OR
       "qwinsta")</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Detects the suspicious commandlines from explorer</title>
        <search>
          <query>index=windows SourceName="Microsoft-Windows-Sysmon" "technique_name=User Execution" EventCode=1 NOT"Microsoft.NET" NOT"bin.net" "Explorer.exe"  ("whoami " OR 
       "arp" OR
       "ipconfig" OR
       "net" OR
       "cmd" OR
       "nslookup" OR
       "nltest" OR
      "net share" OR
      "netstat" OR
       
       "qwinsta") |table ParentUser
ParentImage
ParentCommandLine
User
CommandLine
CurrentDirectory</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>
</form>
